<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice Transformer UI - Professional</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #121212;
            color: #E5E7EB; /* text-gray-200 */
        }
        .panel {
            background-color: #1E1E1E;
            border: 1px solid #374151; /* border-gray-700 */
            border-radius: 0.75rem;
        }
        .preset-card {
            background-color: #374151; /* bg-gray-700 */
            border: 1px solid #4B5563; /* border-gray-600 */
            transition: background-color 0.2s ease, border-color 0.2s ease;
        }
        .preset-card:hover {
            background-color: #4B5563; /* bg-gray-600 */
            border-color: #6B7280; /* border-gray-500 */
        }
        .preset-card.active {
            background-color: #1f2937;
            border-color: #F59E0B; /* border-amber-500 */
            box-shadow: 0 0 0 2px rgba(245, 158, 11, 0.4);
        }
        .preset-card.active svg {
            color: #F59E0B; /* text-amber-500 */
        }
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 4px;
            background: #4B5563; /* bg-gray-600 */
            border-radius: 2px;
            outline: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            background: #E5E7EB; /* bg-gray-200 */
            cursor: pointer;
            border-radius: 50%;
            border: 2px solid #1E1E1E;
            transition: background-color 0.2s ease;
        }
        input[type="range"]::-webkit-slider-thumb:hover {
            background: #F59E0B;
        }
        .toggle-btn {
            background-color: #4B5563;
            transition: background-color 0.2s ease;
        }
        .toggle-btn.active {
            background-color: #F59E0B;
        }
        .toggle-btn.active svg {
            color: #121212;
        }
        .progress-bar {
            transition: width 0.5s ease-in-out;
        }
    </style>
</head>
<body>

    <div class="container mx-auto p-4 max-w-7xl">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <header class="text-center my-6 md:my-10">
            <h1 class="text-3xl md:text-4xl font-bold text-white tracking-tight">VOICE TRANSFORMER</h1>
            <p class="text-md text-gray-400 mt-1">Real-time Voice Processing Core</p>
        </header>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
        <main class="grid grid-cols-1 lg:grid-cols-3 gap-6">

            <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ -->
            <div class="lg:col-span-1 space-y-6">
                
                <!-- –ö–Ω–æ–ø–∫–∞ –≤–∫–ª—é—á–µ–Ω–∏—è -->
                <div class="panel p-5">
                    <button id="start-btn" class="w-full flex items-center justify-center gap-3 bg-amber-600 hover:bg-amber-700 text-white font-bold py-3 px-4 rounded-lg text-lg transition duration-300">
                        <i data-lucide="mic"></i>
                        <span>–í–∫–ª—é—á–∏—Ç—å –º–∏–∫—Ä–æ—Ñ–æ–Ω</span>
                    </button>
                    <p id="status" class="text-center text-gray-500 mt-3 text-sm">–¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã</p>
                </div>

                <!-- –ü—Ä–µ—Å–µ—Ç—ã -->
                <div class="panel p-5">
                    <h2 class="text-xl font-bold mb-4 text-gray-200">–ü—Ä–µ—Å–µ—Ç—ã</h2>
                    <div id="presets-grid" class="grid grid-cols-3 gap-3">
                        <!-- –ü—Ä–µ—Å–µ—Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å—é–¥–∞ —Å –ø–æ–º–æ—â—å—é JS -->
                    </div>
                </div>

                <!-- –§–æ–Ω–æ–≤—ã–µ —à—É–º—ã -->
                <div class="panel p-5">
                    <h2 class="text-xl font-bold mb-4 text-gray-200">–§–æ–Ω–æ–≤—ã–µ —à—É–º—ã</h2>
                    <div id="noise-controls" class="space-y-5">
                        <!-- –≠–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —à—É–º–æ–º –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å—é–¥–∞ —Å –ø–æ–º–æ—â—å—é JS -->
                    </div>
                </div>

                <!-- Neural Engine —ç—Ñ—Ñ–µ–∫—Ç—ã -->
                <div class="panel p-5">
                    <h2 class="text-xl font-bold mb-4 text-gray-200">üß† Neural Engine (Apple M1/M2/M3)</h2>
                    <div class="space-y-4">
                        
                        <!-- –í—ã—Å–æ—Ç–∞ —Ç–æ–Ω–∞ -->
                        <div class="space-y-2">
                            <div class="flex justify-between">
                                <label class="text-sm font-medium text-gray-300">üé∂ –í—ã—Å–æ—Ç–∞ —Ç–æ–Ω–∞</label>
                                <span id="pitch-value" class="text-xs text-gray-400">0 –ø–æ–ª—É—Ç–æ–Ω–æ–≤</span>
                            </div>
                            <input type="range" id="pitch-slider" min="-12" max="12" value="0" step="0.5" class="w-full">
                        </div>

                        <!-- –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≥–æ–ª–æ—Å–∞ -->
                        <div class="space-y-2">
                            <h3 class="text-sm font-semibold text-gray-300">üé® –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≥–æ–ª–æ—Å–∞</h3>
                            <div class="grid grid-cols-3 gap-2">
                                <div>
                                    <label class="text-xs text-gray-400">–ü–æ–ª</label>
                                    <input type="range" id="gender-slider" min="-1" max="1" value="0" step="0.1" class="w-full">
                                    <span id="gender-value" class="text-xs text-gray-500">0</span>
                                </div>
                                <div>
                                    <label class="text-xs text-gray-400">–í–æ–∑—Ä–∞—Å—Ç</label>
                                    <input type="range" id="age-slider" min="-1" max="1" value="0" step="0.1" class="w-full">
                                    <span id="age-value" class="text-xs text-gray-500">0</span>
                                </div>
                                <div>
                                    <label class="text-xs text-gray-400">–ì—Ä—É–±–æ—Å—Ç—å</label>
                                    <input type="range" id="roughness-slider" min="0" max="1" value="0" step="0.1" class="w-full">
                                    <span id="roughness-value" class="text-xs text-gray-500">0</span>
                                </div>
                            </div>
                        </div>

                        <!-- –ì–∞—Ä–º–æ–Ω–∏–∫–∏ -->
                        <div class="space-y-2">
                            <h3 class="text-sm font-semibold text-gray-300">üåà –ì–∞—Ä–º–æ–Ω–∏–∫–∏</h3>
                            <div class="grid grid-cols-2 gap-2">
                                <div>
                                    <label class="text-xs text-gray-400">–û–±–µ—Ä—Ç–æ–Ω—ã</label>
                                    <input type="range" id="overtones-slider" min="0" max="1" value="0" step="0.1" class="w-full">
                                    <span id="overtones-value" class="text-xs text-gray-500">0</span>
                                </div>
                                <div>
                                    <label class="text-xs text-gray-400">–°—É–±–≥–∞—Ä–º–æ–Ω–∏–∫–∏</label>
                                    <input type="range" id="undertones-slider" min="0" max="1" value="0" step="0.1" class="w-full">
                                    <span id="undertones-value" class="text-xs text-gray-500">0</span>
                                </div>
                            </div>
                        </div>

                        <!-- –ú–æ–¥—É–ª—è—Ü–∏—è -->
                        <div class="space-y-2">
                            <h3 class="text-sm font-semibold text-gray-300">üé≠ –ú–æ–¥—É–ª—è—Ü–∏—è</h3>
                            <div class="grid grid-cols-2 gap-2">
                                <div>
                                    <label class="text-xs text-gray-400">–í–∏–±—Ä–∞—Ç–æ</label>
                                    <input type="range" id="vibrato-slider" min="0" max="1" value="0" step="0.1" class="w-full">
                                    <span id="vibrato-value" class="text-xs text-gray-500">0</span>
                                </div>
                                <div>
                                    <label class="text-xs text-gray-400">–¢—Ä–µ–º–æ–ª–æ</label>
                                    <input type="range" id="tremolo-slider" min="0" max="1" value="0" step="0.1" class="w-full">
                                    <span id="tremolo-value" class="text-xs text-gray-500">0</span>
                                </div>
                            </div>
                        </div>

                        <!-- –ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã -->
                        <div class="space-y-2">
                            <h3 class="text-sm font-semibold text-gray-300">üèõÔ∏è –ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ</h3>
                            <div class="grid grid-cols-2 gap-2">
                                <div>
                                    <label class="text-xs text-gray-400">–†–µ–≤–µ—Ä–±</label>
                                    <input type="range" id="reverb-slider" min="0" max="1" value="0" step="0.1" class="w-full">
                                    <span id="reverb-value" class="text-xs text-gray-500">0</span>
                                </div>
                                <div>
                                    <label class="text-xs text-gray-400">–•–æ—Ä—É—Å</label>
                                    <input type="range" id="chorus-slider" min="0" max="1" value="0" step="0.1" class="w-full">
                                    <span id="chorus-value" class="text-xs text-gray-500">0</span>
                                </div>
                            </div>
                        </div>

                        <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã -->
                        <div class="space-y-2">
                            <div class="grid grid-cols-2 gap-2">
                                <div>
                                    <label class="text-xs text-gray-400">üé∏ –ò—Å–∫–∞–∂–µ–Ω–∏—è</label>
                                    <input type="range" id="distortion-slider" min="0" max="1" value="0" step="0.1" class="w-full">
                                    <span id="distortion-value" class="text-xs text-gray-500">0</span>
                                </div>
                                <div>
                                    <label class="text-xs text-gray-400">üéØ –ê–≤—Ç–æ—Ç—é–Ω</label>
                                    <input type="range" id="autotune-slider" min="0" max="1" value="0" step="0.1" class="w-full">
                                    <span id="autotune-value" class="text-xs text-gray-500">0</span>
                                </div>
                            </div>
                        </div>

                        <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ -->
                        <div class="pt-2">
                            <button id="clear-effects-btn" class="w-full bg-red-600 hover:bg-red-700 text-white text-sm font-medium py-2 px-3 rounded-md transition duration-300">
                                üßπ –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
                            </button>
                        </div>

                        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ Neural Engine -->
                        <div class="pt-2 border-t border-gray-600">
                            <div class="text-xs text-gray-400 space-y-1">
                                <div>–ó–∞–¥–µ—Ä–∂–∫–∞: <span id="neural-latency" class="text-amber-400">0</span> –Ω—Å</div>
                                <div>–ö–∞—á–µ—Å—Ç–≤–æ: <span id="neural-quality" class="text-green-400">0</span>/1.0</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏ –ù–∞–≥—Ä—É–∑–∫–∞ -->
            <div class="lg:col-span-2 space-y-6">
                <!-- –ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–∏—Å—Ç–µ–º—É -->
                <div class="panel p-5">
                    <h2 class="text-xl font-bold mb-4 text-gray-200">–ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–∏—Å—Ç–µ–º—É (–°–∏–º—É–ª—è—Ü–∏—è)</h2>
                    <div id="system-load" class="space-y-4">
                        <!-- CPU -->
                        <div>
                            <div class="flex justify-between items-center mb-1">
                                <span class="text-sm font-medium text-gray-400">CPU</span>
                                <span id="cpu-load-text" class="text-sm font-medium text-gray-300">0%</span>
                            </div>
                            <div class="w-full bg-gray-700 rounded-full h-2.5">
                                <div id="cpu-load-bar" class="bg-blue-500 h-2.5 rounded-full progress-bar" style="width: 0%"></div>
                            </div>
                        </div>
                        <!-- GPU -->
                        <div>
                            <div class="flex justify-between items-center mb-1">
                                <span class="text-sm font-medium text-gray-400">GPU</span>
                                <span id="gpu-load-text" class="text-sm font-medium text-gray-300">0%</span>
                            </div>
                            <div class="w-full bg-gray-700 rounded-full h-2.5">
                                <div id="gpu-load-bar" class="bg-green-500 h-2.5 rounded-full progress-bar" style="width: 0%"></div>
                            </div>
                        </div>
                        <!-- NPU -->
                        <div>
                            <div class="flex justify-between items-center mb-1">
                                <span class="text-sm font-medium text-gray-400">NPU (Neural Engine)</span>
                                <span id="npu-load-text" class="text-sm font-medium text-gray-300">0%</span>
                            </div>
                            <div class="w-full bg-gray-700 rounded-full h-2.5">
                                <div id="npu-load-bar" class="bg-amber-500 h-2.5 rounded-full progress-bar" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–∞ -->
                <div class="panel p-5">
                    <h2 class="text-xl font-bold mb-4 text-gray-200">–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–∞</h2>
                    <div class="space-y-6">
                        <div>
                            <h3 class="text-md font-semibold mb-2 text-gray-400">–û—Å—Ü–∏–ª–ª–æ–≥—Ä–∞—Ñ (–§–æ—Ä–º–∞ –≤–æ–ª–Ω—ã)</h3>
                            <canvas id="oscilloscope" class="w-full h-48 bg-black rounded-md"></canvas>
                        </div>
                        <div>
                            <h3 class="text-md font-semibold mb-2 text-gray-400">–ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä —Å–ø–µ–∫—Ç—Ä–∞ (–ß–∞—Å—Ç–æ—Ç—ã)</h3>
                            <canvas id="spectrum" class="w-full h-48 bg-black rounded-md"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // --- –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ---
        let audioContext;
        let analyser;
        let microphone;
        let isInitialized = false;
        const noiseGenerators = {};
        let currentLoad = { cpu: 0, gpu: 0, npu: 0 };
        let baseLoad = { cpu: 4, gpu: 8, npu: 1 };

        // --- –≠–ª–µ–º–µ–Ω—Ç—ã DOM ---
        const startBtn = document.getElementById('start-btn');
        const statusEl = document.getElementById('status');
        const presetsGrid = document.getElementById('presets-grid');
        const noiseControlsContainer = document.getElementById('noise-controls');
        const oscCanvas = document.getElementById('oscilloscope');
        const oscCtx = oscCanvas.getContext('2d');
        const specCanvas = document.getElementById('spectrum');
        const specCtx = specCanvas.getContext('2d');
        
        const cpuLoadBar = document.getElementById('cpu-load-bar');
        const gpuLoadBar = document.getElementById('gpu-load-bar');
        const npuLoadBar = document.getElementById('npu-load-bar');
        const cpuLoadText = document.getElementById('cpu-load-text');
        const gpuLoadText = document.getElementById('gpu-load-text');
        const npuLoadText = document.getElementById('npu-load-text');

        // --- –î–∞–Ω–Ω—ã–µ –¥–ª—è UI ---
        const presets = [
            { name: '–ì–æ–ª–æ—Å-–ß–µ–π–Ω–∂–µ—Ä', icon: 'mic', type: 'hybrid', description: '–ü–æ–ª–Ω–∞—è —Ü–µ–ø–æ—á–∫–∞: DSP ‚Üí NPU ‚Üí Post' },
            { name: '–†–æ–±–æ—Ç', icon: 'bot', type: 'ai' },
            { name: '–ú–æ–Ω—Å—Ç—Ä', icon: 'skull', type: 'dsp' },
            { name: '–í—ã—Å–æ–∫–∏–π', icon: 'arrow-up-circle', type: 'dsp' },
            { name: '–ü–µ—â–µ—Ä–∞', icon: 'mountain', type: 'dsp' },
            { name: '–†–∞—Ü–∏—è', icon: 'radio-tower', type: 'dsp' },
            { name: '–î–µ–º–æ–Ω', icon: 'flame', type: 'ai' },
            { name: '–ü—Ä–∏—à–µ–ª–µ—Ü', icon: 'alien', type: 'ai' },
            { name: '–°–æ–±–æ—Ä', icon: 'church', type: 'dsp' },
            { name: '–ü–æ–¥ –≤–æ–¥–æ–π', icon: 'waves', type: 'dsp' },
        ];

        const noiseTypes = [
            { id: 'white', name: '–ë–µ–ª—ã–π —à—É–º (–°—Ç–∞—Ç–∏–∫–∞)' },
            { id: 'pink', name: '–†–æ–∑–æ–≤—ã–π —à—É–º (–î–æ–∂–¥—å)' },
            { id: 'brown', name: '–ö–æ—Ä–∏—á–Ω–µ–≤—ã–π —à—É–º (–í–µ—Ç–µ—Ä)' },
        ];

        // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è UI ---
        function initializeUI() {
            initNeuralControls();
            presets.forEach(preset => {
                const button = document.createElement('button');
                button.className = 'preset-card p-2 rounded-lg flex flex-col items-center justify-center aspect-square focus:outline-none';
                button.innerHTML = `
                    <i data-lucide="${preset.icon}" class="w-8 h-8 text-gray-300"></i>
                    <span class="text-xs mt-2 text-center text-gray-400">${preset.name}</span>`;
                button.addEventListener('click', () => {
                    if (!isInitialized) return;
                    document.querySelectorAll('.preset-card').forEach(p => p.classList.remove('active'));
                    button.classList.add('active');
                    console.log(`–ü—Ä–µ—Å–µ—Ç "${preset.name}" (${preset.type}) –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω.`);
                    
                    // –°–∏–º—É–ª—è—Ü–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏
                    if (preset.type === 'ai') {
                        // –í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ NPU, –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –Ω–∞ CPU/GPU
                        currentLoad = { cpu: baseLoad.cpu + 4, gpu: baseLoad.gpu + 2, npu: 25 };
                    } else if (preset.type === 'hybrid') {
                        // –ì–∏–±—Ä–∏–¥–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞: —Å—Ä–µ–¥–Ω—è—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
                        currentLoad = { cpu: baseLoad.cpu + 8, gpu: baseLoad.gpu + 5, npu: 45 };
                    } else {
                        // –ü–æ–≤—ã—à–µ–Ω–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ CPU –¥–ª—è DSP, NPU –≤ –ø—Ä–æ—Å—Ç–æ–µ
                        currentLoad = { cpu: baseLoad.cpu + 15, gpu: baseLoad.gpu, npu: baseLoad.npu };
                    }
                });
                presetsGrid.appendChild(button);
            });

            noiseTypes.forEach(noise => {
                const controlDiv = document.createElement('div');
                controlDiv.innerHTML = `
                    <div class="flex items-center justify-between">
                        <label for="${noise.id}-toggle" class="font-medium text-gray-300">${noise.name}</label>
                        <button id="${noise.id}-toggle" class="toggle-btn p-2 rounded-full focus:outline-none" data-state="off">
                            <i data-lucide="play" class="w-4 h-4 text-gray-200"></i>
                        </button>
                    </div>
                    <input type="range" id="${noise.id}-volume" min="-40" max="0" value="-20" step="1" class="w-full mt-2" disabled>
                `;
                noiseControlsContainer.appendChild(controlDiv);

                const toggleBtn = document.getElementById(`${noise.id}-toggle`);
                const volumeSlider = document.getElementById(`${noise.id}-volume`);

                toggleBtn.addEventListener('click', () => {
                    if (!isInitialized) return;
                    const noiseGen = noiseGenerators[noise.id];
                    if (toggleBtn.dataset.state === 'off') {
                        noiseGen.start();
                        toggleBtn.dataset.state = 'on';
                        toggleBtn.innerHTML = '<i data-lucide="pause" class="w-4 h-4"></i>';
                        toggleBtn.classList.add('active');
                        volumeSlider.disabled = false;
                    } else {
                        noiseGen.stop();
                        toggleBtn.dataset.state = 'off';
                        toggleBtn.innerHTML = '<i data-lucide="play" class="w-4 h-4"></i>';
                        toggleBtn.classList.remove('active');
                        volumeSlider.disabled = true;
                    }
                    lucide.createIcons();
                });

                volumeSlider.addEventListener('input', (e) => {
                    if (!isInitialized) return;
                    noiseGenerators[noise.id].volume.value = e.target.value;
                });
            });
            lucide.createIcons();
        }

        // --- Neural Engine —Ñ—É–Ω–∫—Ü–∏–∏ ---
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π —Å–ª–∞–π–¥–µ—Ä–æ–≤
        function updateSliderValue(sliderId, valueId, suffix = '') {
            const slider = document.getElementById(sliderId);
            const valueSpan = document.getElementById(valueId);
            if (slider && valueSpan) {
                valueSpan.textContent = slider.value + suffix;
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Neural Engine –∫–æ–Ω—Ç—Ä–æ–ª–æ–≤
        function initNeuralControls() {
            // –í—ã—Å–æ—Ç–∞ —Ç–æ–Ω–∞
            const pitchSlider = document.getElementById('pitch-slider');
            const pitchValue = document.getElementById('pitch-value');
            pitchSlider.addEventListener('input', (e) => {
                const value = parseFloat(e.target.value);
                pitchValue.textContent = `${value} –ø–æ–ª—É—Ç–æ–Ω–æ–≤`;
                // –°–∏–º—É–ª—è—Ü–∏—è –≤—ã–∑–æ–≤–∞ C API
                console.log(`üß† Neural Engine: Pitch Shift ${value} –ø–æ–ª—É—Ç–æ–Ω–æ–≤`);
                updateNeuralLoad();
            });

            // –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≥–æ–ª–æ—Å–∞
            const genderSlider = document.getElementById('gender-slider');
            const ageSlider = document.getElementById('age-slider');
            const roughnessSlider = document.getElementById('roughness-slider');
            
            function updateVoiceChanger() {
                const gender = parseFloat(genderSlider.value);
                const age = parseFloat(ageSlider.value);
                const roughness = parseFloat(roughnessSlider.value);
                
                document.getElementById('gender-value').textContent = gender.toFixed(1);
                document.getElementById('age-value').textContent = age.toFixed(1);
                document.getElementById('roughness-value').textContent = roughness.toFixed(1);
                
                console.log(`üß† Neural Engine: Voice Changer - Gender: ${gender}, Age: ${age}, Roughness: ${roughness}`);
                updateNeuralLoad();
            }
            
            genderSlider.addEventListener('input', updateVoiceChanger);
            ageSlider.addEventListener('input', updateVoiceChanger);
            roughnessSlider.addEventListener('input', updateVoiceChanger);

            // –ì–∞—Ä–º–æ–Ω–∏–∫–∏
            const overtonesSlider = document.getElementById('overtones-slider');
            const undertonesSlider = document.getElementById('undertones-slider');
            
            function updateHarmonics() {
                const overtones = parseFloat(overtonesSlider.value);
                const undertones = parseFloat(undertonesSlider.value);
                
                document.getElementById('overtones-value').textContent = overtones.toFixed(1);
                document.getElementById('undertones-value').textContent = undertones.toFixed(1);
                
                console.log(`üß† Neural Engine: Harmonics - Overtones: ${overtones}, Undertones: ${undertones}`);
                updateNeuralLoad();
            }
            
            overtonesSlider.addEventListener('input', updateHarmonics);
            undertonesSlider.addEventListener('input', updateHarmonics);

            // –ú–æ–¥—É–ª—è—Ü–∏—è
            const vibratoSlider = document.getElementById('vibrato-slider');
            const tremoloSlider = document.getElementById('tremolo-slider');
            
            function updateModulation() {
                const vibrato = parseFloat(vibratoSlider.value);
                const tremolo = parseFloat(tremoloSlider.value);
                
                document.getElementById('vibrato-value').textContent = vibrato.toFixed(1);
                document.getElementById('tremolo-value').textContent = tremolo.toFixed(1);
                
                console.log(`üß† Neural Engine: Modulation - Vibrato: ${vibrato}, Tremolo: ${tremolo}`);
                updateNeuralLoad();
            }
            
            vibratoSlider.addEventListener('input', updateModulation);
            tremoloSlider.addEventListener('input', updateModulation);

            // –ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
            const reverbSlider = document.getElementById('reverb-slider');
            const chorusSlider = document.getElementById('chorus-slider');
            
            function updateSpatialEffects() {
                const reverb = parseFloat(reverbSlider.value);
                const chorus = parseFloat(chorusSlider.value);
                
                document.getElementById('reverb-value').textContent = reverb.toFixed(1);
                document.getElementById('chorus-value').textContent = chorus.toFixed(1);
                
                console.log(`üß† Neural Engine: Spatial - Reverb: ${reverb}, Chorus: ${chorus}`);
                updateNeuralLoad();
            }
            
            reverbSlider.addEventListener('input', updateSpatialEffects);
            chorusSlider.addEventListener('input', updateSpatialEffects);

            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
            const distortionSlider = document.getElementById('distortion-slider');
            const autotuneSlider = document.getElementById('autotune-slider');
            
            distortionSlider.addEventListener('input', (e) => {
                const value = parseFloat(e.target.value);
                document.getElementById('distortion-value').textContent = value.toFixed(1);
                console.log(`üß† Neural Engine: Distortion ${value}`);
                updateNeuralLoad();
            });
            
            autotuneSlider.addEventListener('input', (e) => {
                const value = parseFloat(e.target.value);
                document.getElementById('autotune-value').textContent = value.toFixed(1);
                console.log(`üß† Neural Engine: Autotune ${value}`);
                updateNeuralLoad();
            });

            // –û—á–∏—Å—Ç–∫–∞ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
            const clearEffectsBtn = document.getElementById('clear-effects-btn');
            clearEffectsBtn.addEventListener('click', () => {
                // –°–±—Ä–æ—Å –≤—Å–µ—Ö —Å–ª–∞–π–¥–µ—Ä–æ–≤
                pitchSlider.value = 0;
                genderSlider.value = 0;
                ageSlider.value = 0;
                roughnessSlider.value = 0;
                overtonesSlider.value = 0;
                undertonesSlider.value = 0;
                vibratoSlider.value = 0;
                tremoloSlider.value = 0;
                reverbSlider.value = 0;
                chorusSlider.value = 0;
                distortionSlider.value = 0;
                autotuneSlider.value = 0;
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
                updateVoiceChanger();
                updateHarmonics();
                updateModulation();
                updateSpatialEffects();
                pitchValue.textContent = '0 –ø–æ–ª—É—Ç–æ–Ω–æ–≤';
                document.getElementById('distortion-value').textContent = '0';
                document.getElementById('autotune-value').textContent = '0';
                
                console.log('üßπ Neural Engine: –í—Å–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –æ—á–∏—â–µ–Ω—ã');
                updateNeuralLoad();
            });
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ Neural Engine
        function updateNeuralLoad() {
            // –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
            let totalLoad = 0;
            const sliders = [
                'pitch-slider', 'gender-slider', 'age-slider', 'roughness-slider',
                'overtones-slider', 'undertones-slider', 'vibrato-slider', 'tremolo-slider',
                'reverb-slider', 'chorus-slider', 'distortion-slider', 'autotune-slider'
            ];
            
            sliders.forEach(sliderId => {
                const slider = document.getElementById(sliderId);
                if (slider && parseFloat(slider.value) !== 0) {
                    totalLoad += parseFloat(slider.value) * 10; // –ë–∞–∑–æ–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞
                    
                    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
                    if (['autotune-slider', 'reverb-slider', 'chorus-slider'].includes(sliderId)) {
                        totalLoad += parseFloat(slider.value) * 15;
                    }
                }
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º NPU –Ω–∞–≥—Ä—É–∑–∫—É
            currentLoad.npu = Math.min(Math.max(totalLoad, baseLoad.npu), 95);
            
            // –°–∏–º—É–ª–∏—Ä—É–µ–º –∑–∞–¥–µ—Ä–∂–∫—É –∏ –∫–∞—á–µ—Å—Ç–≤–æ
            const latency = Math.floor(1000 + totalLoad * 500); // –ù–∞–Ω–æ—Å–µ–∫—É–Ω–¥—ã
            const quality = Math.max(0.95 - totalLoad * 0.01, 0.5); // –ö–∞—á–µ—Å—Ç–≤–æ
            
            document.getElementById('neural-latency').textContent = latency.toLocaleString();
            document.getElementById('neural-quality').textContent = quality.toFixed(2);
        }

        // --- –û—Å–Ω–æ–≤–Ω–∞—è –∞—É–¥–∏–æ –ª–æ–≥–∏–∫–∞ ---
        async function startAudio() {
            if (isInitialized) return;
            try {
                await Tone.start();
                audioContext = Tone.getContext().rawContext;
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true, video: false });
                microphone = audioContext.createMediaStreamSource(stream);
                analyser = audioContext.createAnalyser();
                analyser.fftSize = 2048;
                
                noiseTypes.forEach(noise => {
                    noiseGenerators[noise.id] = new Tone.Noise(noise.id).toDestination();
                    noiseGenerators[noise.id].volume.value = -20;
                });

                microphone.connect(analyser);
                analyser.connect(audioContext.destination);

                isInitialized = true;
                currentLoad = baseLoad; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –±–∞–∑–æ–≤—É—é –Ω–∞–≥—Ä—É–∑–∫—É
                startBtn.innerHTML = '<i data-lucide="check-circle"></i><span>–ú–∏–∫—Ä–æ—Ñ–æ–Ω –∞–∫—Ç–∏–≤–µ–Ω</span>';
                startBtn.classList.replace('bg-amber-600', 'bg-green-600');
                startBtn.classList.remove('hover:bg-amber-700');
                startBtn.disabled = true;
                statusEl.textContent = '–ê—É–¥–∏–æ—Å–∏—Å—Ç–µ–º–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞';
                lucide.createIcons();

                resizeCanvases();
                draw();
                setInterval(updateLoadUI, 500); // –ó–∞–ø—É—Å–∫–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –Ω–∞–≥—Ä—É–∑–∫–∏
            } catch (err) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ—Å—Ç—É–ø–µ –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É:', err);
                statusEl.textContent = '–û—à–∏–±–∫–∞: –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É.';
                statusEl.classList.add('text-red-400');
            }
        }
        
        // --- –õ–æ–≥–∏–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏ –∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ ---
        function updateLoadUI() {
            if (!isInitialized) return;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–±–æ–ª—å—à–∏–µ —Ñ–ª—É–∫—Ç—É–∞—Ü–∏–∏ –¥–ª—è —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ—Å—Ç–∏
            const fluctuate = (val) => Math.max(0, Math.min(100, val + (Math.random() * 4 - 2)));
            
            const cpu = fluctuate(currentLoad.cpu);
            const gpu = fluctuate(currentLoad.gpu);
            const npu = fluctuate(currentLoad.npu);

            cpuLoadBar.style.width = `${cpu}%`;
            cpuLoadText.textContent = `${Math.round(cpu)}%`;
            gpuLoadBar.style.width = `${gpu}%`;
            gpuLoadText.textContent = `${Math.round(gpu)}%`;
            npuLoadBar.style.width = `${npu}%`;
            npuLoadText.textContent = `${Math.round(npu)}%`;
        }

        function draw() {
            if (!isInitialized) return;
            requestAnimationFrame(draw);
            drawOscilloscope();
            drawSpectrum();
        }

        function drawOscilloscope() {
            const bufferLength = analyser.fftSize;
            const dataArray = new Uint8Array(bufferLength);
            analyser.getByteTimeDomainData(dataArray);
            oscCtx.fillStyle = '#000000';
            oscCtx.fillRect(0, 0, oscCanvas.width, oscCanvas.height);
            oscCtx.lineWidth = 2;
            oscCtx.strokeStyle = '#F59E0B'; // amber-500
            oscCtx.beginPath();
            const sliceWidth = oscCanvas.width * 1.0 / bufferLength;
            let x = 0;
            for (let i = 0; i < bufferLength; i++) {
                const v = dataArray[i] / 128.0;
                const y = v * oscCanvas.height / 2;
                if (i === 0) { oscCtx.moveTo(x, y); } else { oscCtx.lineTo(x, y); }
                x += sliceWidth;
            }
            oscCtx.lineTo(oscCanvas.width, oscCanvas.height / 2);
            oscCtx.stroke();
        }

        function drawSpectrum() {
            const bufferLength = analyser.frequencyBinCount;
            const dataArray = new Uint8Array(bufferLength);
            analyser.getByteFrequencyData(dataArray);
            specCtx.fillStyle = '#000000';
            specCtx.fillRect(0, 0, specCanvas.width, specCanvas.height);
            const barWidth = (specCanvas.width / bufferLength) * 2.5;
            let barHeight;
            let x = 0;
            for (let i = 0; i < bufferLength; i++) {
                barHeight = dataArray[i];
                const percent = barHeight / 255;
                const hue = 240 - (percent * 180); // –æ—Ç —Å–∏–Ω–µ–≥–æ (240) –∫ –∫—Ä–∞—Å–Ω–æ–º—É (60)
                specCtx.fillStyle = `hsl(${hue}, 100%, 50%)`;
                specCtx.fillRect(x, specCanvas.height - barHeight / 1.5, barWidth, barHeight / 1.5);
                x += barWidth + 1;
            }
        }
        
        function resizeCanvases() {
            [oscCanvas, specCanvas].forEach(canvas => {
                canvas.width = canvas.clientWidth * window.devicePixelRatio;
                canvas.height = canvas.clientHeight * window.devicePixelRatio;
            });
        }

        // --- Event Listeners ---
        startBtn.addEventListener('click', startAudio);
        window.addEventListener('resize', resizeCanvases);

        // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ---
        initializeUI();
    </script>
</body>
</html>
